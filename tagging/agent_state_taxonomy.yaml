# Agent-State Tag Taxonomy v2.1
# Hierarchical colon-delimited tags for archive entry classification.
# Each tag encodes one observable dimension of agent/session state.
#
# scope field on each tag:
#   entry   -- varies between entries in a session (per-entry state)
#   session -- constant across all entries in a session (aggregate metrics)
#   both    -- may vary or be constant depending on context

version: "2.1"
name: "agent-state"
description: "Hierarchical colon-delimited tag taxonomy for archive entry classification"

dimensions:
  # =========================================================================
  # 1. phase -- Skill lifecycle phase active when entry was created
  # =========================================================================
  phase:
    description: "Skill lifecycle phase active when entry was created"
    tags:
      - name: "phase:alignment"
        description: "In alignment/Q&A phase of a skill"
        scope: entry
      - name: "phase:planning"
        description: "In planning phase of a skill"
        scope: entry
      - name: "phase:execution"
        description: "In execution phase of a skill"
        scope: entry
      - name: "phase:finalization"
        description: "In finalization phase of a skill"
        scope: entry
      - name: "phase:readme-wave"
        description: "In README update wave of update-and-archive"
        scope: entry
      - name: "phase:oracle-regen"
        description: "In oracle regeneration phase of update-and-archive"
        scope: entry
      - name: "phase:porcelain"
        description: "In porcelain/git-sync phase of update-and-archive"
        scope: entry
      - name: "phase:archive-upload"
        description: "In archive upload phase of update-and-archive"
        scope: entry
      - name: "phase:idle"
        description: "No skill active, system is idle between tasks"
        scope: entry

  # =========================================================================
  # 2. transition -- State machine transition type for this entry
  # =========================================================================
  transition:
    description: "State machine transition type recorded in this entry"
    tags:
      - name: "transition:phase-start"
        description: "Entry marks the start of a new phase"
        scope: entry
      - name: "transition:phase-end"
        description: "Entry marks the end of a phase"
        scope: entry
      - name: "transition:handoff"
        description: "Atomic skill-to-skill handoff occurred"
        scope: entry
      - name: "transition:epoch-close"
        description: "Entry closes an epoch (update-and-archive completion)"
        scope: entry
      - name: "transition:backward"
        description: "Phase regression detected (went back to earlier phase)"
        scope: entry
      - name: "transition:phase-fail"
        description: "Phase failed without completing (e.g., gate failure, error)"
        scope: entry
      - name: "transition:none"
        description: "No state transition in this entry"
        scope: entry

  # =========================================================================
  # 3. skill -- Which skill was active when entry was created
  # =========================================================================
  skill:
    description: "Which skill was active when the entry was created"
    tags:
      - name: "skill:task"
        description: "The /task skill was active"
        scope: both
      - name: "skill:self-improve"
        description: "The /self-improve skill was active"
        scope: both
      - name: "skill:update-and-archive"
        description: "The /update-and-archive skill was active"
        scope: both
      - name: "skill:log"
        description: "The /log skill was active"
        scope: both
      - name: "skill:none"
        description: "No skill was active (idle state)"
        scope: both

  # =========================================================================
  # 4. trigger -- What caused this archive entry to be created
  # =========================================================================
  trigger:
    description: "What caused this archive entry to be created"
    tags:
      - name: "trigger:build"
        description: "Entry created by a build pipeline run"
        scope: both
      - name: "trigger:skill"
        description: "Entry created by a skill lifecycle event"
        scope: both
      - name: "trigger:manual"
        description: "Entry created by manual sbs archive upload"
        scope: both
      - name: "trigger:improvement"
        description: "Entry created by mid-session improvement capture"
        scope: both

  # =========================================================================
  # 5. session -- Behavioral profile of the Claude Code session
  # =========================================================================
  session:
    description: "Behavioral profile of the Claude Code session"
    tags:
      - name: "session:exploration-heavy"
        description: "Session dominated by file reads and searches"
        scope: session
      - name: "session:edit-heavy"
        description: "Session dominated by file edits and writes"
        scope: session
      - name: "session:creation-heavy"
        description: "Session dominated by new file creation"
        scope: session
      - name: "session:bash-heavy"
        description: "Session dominated by shell command execution"
        scope: session
      - name: "session:mcp-heavy"
        description: "Session dominated by MCP tool calls"
        scope: session
      - name: "session:search-heavy"
        description: "Session dominated by grep/glob/search operations"
        scope: session
      - name: "session:delegation-heavy"
        description: "Session dominated by agent spawning and orchestration"
        scope: session
      - name: "session:interactive"
        description: "Session had significant back-and-forth with user"
        scope: session
      - name: "session:one-shot"
        description: "Session completed in a single agent turn"
        scope: session
      - name: "session:multi-session"
        description: "Work spanned multiple Claude Code sessions"
        scope: session
      - name: "session:long"
        description: "Session duration exceeded 30 minutes"
        scope: session
      - name: "session:short"
        description: "Session duration under 5 minutes"
        scope: session
      - name: "session:tool-diverse"
        description: "Session used 10+ unique tool types"
        scope: session
      - name: "session:tool-narrow"
        description: "Session used fewer than 4 unique tool types"
        scope: session

  # =========================================================================
  # 6. outcome -- Observable results of the session or skill
  # =========================================================================
  outcome:
    description: "Observable results of the session or skill"
    tags:
      - name: "outcome:gate-pass"
        description: "Gate validation passed"
        scope: entry
      - name: "outcome:gate-fail"
        description: "Gate validation failed"
        scope: entry
      - name: "outcome:gate-override"
        description: "Gate failure was overridden by user"
        scope: entry
      - name: "outcome:build-success"
        description: "Project build completed successfully"
        scope: both
      - name: "outcome:build-fail"
        description: "Project build failed"
        scope: both
      - name: "outcome:pr-created"
        description: "A pull request was created during this session"
        scope: entry
      - name: "outcome:pr-merged"
        description: "A pull request was merged during this session"
        scope: entry
      - name: "outcome:issue-created"
        description: "A GitHub issue was created during this session"
        scope: both
      - name: "outcome:issue-closed"
        description: "A GitHub issue was closed during this session"
        scope: both
      - name: "outcome:clean-execution"
        description: "Task completed without retries or corrections"
        scope: session
      - name: "outcome:had-retries"
        description: "Task required retries or error recovery"
        scope: session
      - name: "outcome:task-completed"
        description: "The skill/task reached successful completion"
        scope: entry
      - name: "outcome:task-incomplete"
        description: "The skill/task did not reach completion"
        scope: entry
      - name: "outcome:quality-improved"
        description: "Quality scores improved vs previous entry"
        scope: entry
      - name: "outcome:quality-regressed"
        description: "Quality scores decreased vs previous entry"
        scope: entry
      - name: "outcome:quality-stable"
        description: "Quality scores unchanged vs previous entry"
        scope: entry
      - name: "outcome:scope-expanded"
        description: "Plan files were modified during execution phase (scope creep)"
        scope: both
      - name: "outcome:build-after-fix-failed"
        description: "Build failed after recent file edits (fix attempt unsuccessful)"
        scope: both

  # =========================================================================
  # 7. signal -- Anomaly or attention signals detected
  # =========================================================================
  signal:
    description: "Anomaly or attention signals detected in the session"
    tags:
      - name: "signal:backward-transition"
        description: "Phase regression detected in state machine"
        scope: entry
      - name: "signal:consecutive-bash-failures"
        description: "3+ bash commands failed in a row without success between them"
        scope: session
      - name: "signal:same-command-retry"
        description: "Same command (tool+file) executed 3+ times in a session"
        scope: session
      - name: "signal:cli-misfire"
        description: "CLI argument errors detected in session"
        scope: session
      - name: "signal:max-tokens-hit"
        description: "Session hit the maximum token limit"
        scope: session
      - name: "signal:context-compaction"
        description: "Context window compaction occurred mid-session"
        scope: session
      - name: "signal:user-correction"
        description: "User corrected or redirected agent behavior"
        scope: entry
      - name: "signal:retry-loop"
        description: "Agent attempted the same operation 3+ times"
        scope: session
      - name: "signal:high-churn"
        description: "Files were edited then reverted or re-edited repeatedly"
        scope: session
      - name: "signal:sync-error"
        description: "Git sync or push operation failed"
        scope: entry
      - name: "signal:stale-metrics"
        description: "Quality metrics are stale (not updated recently)"
        scope: entry

  # =========================================================================
  # 8. scope -- Breadth and type of changes
  # =========================================================================
  scope:
    description: "Breadth and type of changes in the session"
    tags:
      - name: "scope:cross-repo"
        description: "Changes touched 3+ repositories"
        scope: both
      - name: "scope:multi-repo"
        description: "Changes touched 2 repositories"
        scope: both
      - name: "scope:single-repo"
        description: "Changes confined to a single repository"
        scope: both
      - name: "scope:docs-only"
        description: "Only documentation files were modified"
        scope: both
      - name: "scope:code-only"
        description: "Only code files were modified (no docs)"
        scope: both
      - name: "scope:mixed"
        description: "Both code and documentation files were modified"
        scope: both
      - name: "scope:css-js"
        description: "Changes included CSS or JavaScript assets"
        scope: both
      - name: "scope:lean"
        description: "Changes included Lean source files"
        scope: both
      - name: "scope:python"
        description: "Changes included Python source files"
        scope: both
      - name: "scope:config"
        description: "Changes included configuration files"
        scope: both
      - name: "scope:wide"
        description: "Changes touched 10+ files across multiple concerns"
        scope: both
      - name: "scope:narrow"
        description: "Changes confined to 3 or fewer files"
        scope: both

  # =========================================================================
  # 9. repo -- Which repositories were touched
  # =========================================================================
  repo:
    description: "Which repositories were touched in this session"
    tags:
      - name: "repo:dress"
        description: "Dress repository was modified"
        scope: both
      - name: "repo:runway"
        description: "Runway repository was modified"
        scope: both
      - name: "repo:sbs-test"
        description: "SBS-Test repository was modified"
        scope: both
      - name: "repo:gcr"
        description: "GCR (General Crystallographic Restriction) was modified"
        scope: both
      - name: "repo:pnt"
        description: "PNT (PrimeNumberTheoremAnd) was modified"
        scope: both
      - name: "repo:verso"
        description: "Verso fork was modified"
        scope: both
      - name: "repo:subverso"
        description: "SubVerso fork was modified"
        scope: both
      - name: "repo:lean-architect"
        description: "LeanArchitect fork was modified"
        scope: both
      - name: "repo:dress-blueprint-action"
        description: "dress-blueprint-action (CI/CD + assets) was modified"
        scope: both
      - name: "repo:sbs-lsp-mcp"
        description: "sbs-lsp-mcp server was modified"
        scope: both
      - name: "repo:dev-scripts"
        description: "dev/scripts Python tooling was modified"
        scope: both
      - name: "repo:dev-storage"
        description: "dev/storage data or config was modified"
        scope: both

  # =========================================================================
  # 10. epoch -- Position and character of the current epoch
  # =========================================================================
  epoch:
    description: "Position and character of the current epoch"
    tags:
      - name: "epoch:opening"
        description: "First entry in a new epoch"
        scope: entry
      - name: "epoch:closing"
        description: "Final entry closing this epoch"
        scope: entry
      - name: "epoch:long"
        description: "Epoch spans 20+ entries"
        scope: entry
      - name: "epoch:short"
        description: "Epoch spans fewer than 5 entries"
        scope: entry
      - name: "epoch:build-heavy"
        description: "Epoch contains 3+ build-triggered entries"
        scope: entry
      - name: "epoch:no-builds"
        description: "Epoch contains zero build-triggered entries"
        scope: entry

  # =========================================================================
  # 11. linkage -- GitHub artifact linkage
  # =========================================================================
  linkage:
    description: "GitHub artifact linkage for this entry"
    tags:
      - name: "linkage:has-issue"
        description: "Entry references at least one GitHub issue"
        scope: entry
      - name: "linkage:has-pr"
        description: "Entry references at least one pull request"
        scope: entry
      - name: "linkage:has-plan"
        description: "A plan file was active during this session"
        scope: both
      - name: "linkage:issue-driven"
        description: "Task was initiated from a GitHub issue"
        scope: both
      - name: "linkage:multi-issue"
        description: "Entry references 2+ GitHub issues"
        scope: entry
      - name: "linkage:standalone"
        description: "No issue or PR references"
        scope: entry

  # =========================================================================
  # 12. token -- Token usage profile
  # =========================================================================
  token:
    description: "Token usage profile for the session"
    tags:
      - name: "token:input-heavy"
        description: "Input tokens exceeded 500K"
        scope: session
      - name: "token:output-heavy"
        description: "Output tokens exceeded 50K"
        scope: session
      - name: "token:cache-efficient"
        description: "Cache read tokens exceeded 50% of input tokens"
        scope: session
      - name: "token:cache-unused"
        description: "Cache read tokens below 10% of input tokens"
        scope: session
      - name: "token:total-heavy"
        description: "Total tokens exceeded 1M"
        scope: session
      - name: "token:total-light"
        description: "Total tokens under 100K"
        scope: session
      - name: "token:efficient"
        description: "High output-to-input ratio (productive session)"
        scope: session

  # =========================================================================
  # 13. thinking -- Extended thinking usage
  # =========================================================================
  thinking:
    description: "Extended thinking usage in the session"
    tags:
      - name: "thinking:heavy"
        description: "10+ thinking blocks used in session"
        scope: session
      - name: "thinking:none"
        description: "No thinking blocks used"
        scope: session
      - name: "thinking:extended"
        description: "At least one thinking block exceeded 2K tokens"
        scope: session
      - name: "thinking:deep"
        description: "Average thinking block exceeded 1K tokens"
        scope: session

  # =========================================================================
  # 14. tool -- Tool usage patterns
  # =========================================================================
  tool:
    description: "Tool usage patterns in the session"
    tags:
      - name: "tool:read-dominant"
        description: "Read/file-access tools were the most used category"
        scope: session
      - name: "tool:edit-dominant"
        description: "Edit/write tools were the most used category"
        scope: session
      - name: "tool:bash-dominant"
        description: "Bash tool was the most used tool"
        scope: session
      - name: "tool:task-dominant"
        description: "Task/agent spawning was the most used tool"
        scope: session
      - name: "tool:failure-rate-high"
        description: "More than 20% of tool calls returned errors"
        scope: session
      - name: "tool:failure-rate-zero"
        description: "Zero tool call failures in session"
        scope: session
      - name: "tool:slow-operations"
        description: "Session included operations that timed out or took >60s"
        scope: session

  # =========================================================================
  # 15. quality -- Quality score state
  # =========================================================================
  quality:
    description: "Quality score state for this entry"
    tags:
      - name: "quality:high"
        description: "Overall quality score above 0.9"
        scope: entry
      - name: "quality:low"
        description: "Overall quality score below 0.7"
        scope: entry
      - name: "quality:all-pass"
        description: "All deterministic validators passed"
        scope: entry
      - name: "quality:t5-fail"
        description: "T5 (status color match) validator failed"
        scope: entry
      - name: "quality:t6-fail"
        description: "T6 (CSS variable coverage) validator failed"
        scope: entry
      - name: "quality:unscored"
        description: "No quality scores available for this entry"
        scope: entry

  # =========================================================================
  # 16. model -- Model usage
  # =========================================================================
  model:
    description: "Model usage in the session"
    tags:
      - name: "model:opus"
        description: "Opus model was used (primary or only)"
        scope: session
      - name: "model:sonnet"
        description: "Sonnet model was used (primary or only)"
        scope: session
      - name: "model:haiku"
        description: "Haiku model was used (primary or only)"
        scope: session
      - name: "model:multi-model"
        description: "Multiple model versions were used in session"
        scope: session
      - name: "model:single-model"
        description: "Only one model version was used in session"
        scope: session

  # =========================================================================
  # 17. improvement -- Improvement opportunity classification
  # =========================================================================
  improvement:
    description: "Improvement opportunity captured mid-session"
    tags:
      - name: "improvement:process"
        description: "Process or workflow improvement idea"
        scope: entry
      - name: "improvement:interaction"
        description: "Human-AI interaction pattern improvement"
        scope: entry
      - name: "improvement:workflow"
        description: "Workflow automation or friction reduction"
        scope: entry
      - name: "improvement:tooling"
        description: "Tooling or infrastructure improvement"
        scope: entry
      - name: "improvement:other"
        description: "Uncategorized improvement observation"
        scope: entry
